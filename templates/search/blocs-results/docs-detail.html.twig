{% import "common/notice-available-macro.html.twig" as macros %}

{% if notice is not empty %}
    <div class="list-result__content-item js-list-result-item">
        <div class="list-result__content-selector">
            <input type="checkbox" id="result-doc-{{ type }}-{{ index }}"
                   class="js-notice addableInList notice_{{ type }}"
                   name="{% if  type == constant('App\\Model\\Notice::SEE_ONLINE') %}online[]{% else %}onshelves[]{% endif %}"
                   value="{{ notice.permalink }}"
                {% if mode is defined and mode == 'detail' %}checked="checked"{% endif %}>
            <label for="result-doc-{{ type }}-{{ index }}">
                <span class="sr-only">{{ 'bloc.notice-simple.result'|trans }} {{ index + 1 }}, {{ 'bloc.notice-simple.select'|trans }} {{ notice.frontTitle }}</span>
                {{ index +1 }}
            </label>

            {% from 'search/blocs-results/macros.html.twig' import add_to_list_form %}
            {{ add_to_list_form(
                notice.permalink,
                path('record_bibliographic', {'permalink': notice.permalink}),
                notice.frontTitle,
                notice.frontAuthor,
                notice.type,
                class_name(notice)
            ) }}
        </div>

        {% set contextToken = (objSearch is defined ? objSearch.contextToken : null) %}
        <div class="list-result__content-body">
            <div class="list-result__content-image">
                <a href="{{ path('record_bibliographic', {'permalink': notice.permalink, 'searchToken': contextToken}) }}"
                   aria-label="{{ notice.frontTitle }}"
                >
                    <img src="{{ path('binary_image', {"content":notice.image, 'type': notice.type | slugify})}}" alt="" class="img-fluid" />
                </a>
            </div>
            <div class="list-result__content-infos">
                <a href="{{ path('record_bibliographic', {'permalink': notice.permalink, 'searchToken': contextToken}) }}"
                   lang="fr"
                   aria-label="{{ notice.frontTitle }}"
                   class="n2 list-result__content-title"
                >
                    <img src="{{ asset('images/types/type-' ~ notice.slugifiedType ~ '.svg') }}" alt="" class="list-result__content-type" />
                    <span>{{ notice.frontTitle }}</span>
                </a>
                {% if notice.frontAuthor is not empty %}
                    <p lang="fr"><span class="font-italic">par</span> {{ notice.frontAuthor }}</p>
                {% endif %}
                <p lang="fr">
                {{ notice.frontDate }}
                    {% if notice.frontResume is not empty %}
                    - <button class="list-result__content-resume" type="button"
                            role="tooltip" data-toggle="tooltip" title="{{ 'bloc.notice-simple.resume-title'|trans }} {{ notice.frontResume }}">
                        <img src="{{ asset('images/icones/icone-resume.svg') }}" alt=""/>
                        <span class="sr-only">{{ 'bloc.notice-simple.resume-label'|trans }}</span>
                    </button>
                    {% endif %}
                </p>
                {% if notice.configurationName is not empty %}
                    <p lang="fr">Résultat de <a href="#" aria-label="Acceder à {{ notice.configurationName }}">{{ notice.configurationName }}</a></p>
                {% endif %}

                {% for available in notice.copies %}
                    {# TODO : afficher la location + category également pour les documents rayon disponible #}
                    {{ macros.availibility(available, notice) }}

                    {% if loop.first and not loop.last %}
                        <button type="button" class="btn btn-small-link" data-toggle="collapse"
                                data-target="#availabity-items-{{ index }}" aria-expanded="false"
                                aria-controls="availabity-items-{{ index }}">Voir plus
                        </button>
                        <div class="collapse" id="availabity-items-{{ index }}">
                    {% endif %}

                    {% if not loop.first and loop.last %}
                        </div>
                    {% endif %}
                {% endfor %}
                {% for link in notice.links %}
                    {{macros.availibility(link, notice) }}
                    {% if loop.first and not loop.last %}
                        <button type="button" class="btn btn-small-link" data-toggle="collapse"
                                data-target="#links-items-{{ index }}" aria-expanded="false"
                                aria-controls="links-items-{{ index }}">Voir plus
                        </button>
                        <div class="collapse" id="links-items-{{ index }}">
                    {% endif %}

                    {% if not loop.first and loop.last %}
                        </div>
                    {% endif %}
                {% endfor %}
            </div>

            {% if mode is defined and mode == 'full' %}
            {# TODO : A quoi correspond ce bloc ? Si c'est pour le "voir tout" revoir le gabarit car il n'est pas bon #}
                <div class="list-result__content-txt">
                    <p lang="fr">{{ 'bloc.notice-simple.resume-title'|trans }} {{ notice.frontResume }}</p>
                </div>
            {% endif %}
        </div>
    </div>
{% endif %}
